<!DOCTYPE HTML>
<!-- Signals to the Layout Dialect which layout should be used to decorate this View -->
<html xmlns:layout="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.w3.org/1999/xhtml"
      layout:decorate="~{layout}" lang="en">

<!-- <head section> -->
<th:block layout:fragment="head" th:remove="tag">
  <!-- Page specific head additions -->
  <title>Strings Algo</title>
  <!-- Override colors.css -->
</th:block>

<!-- <body> -->
<th:block layout:fragment="body" th:remove="tag">
<!-- Page specific body additions -->
  <div class="container py-4">
    <header class="pb-3 mb-4 border-bottom border-primary">
      <div class="d-flex align-items-center text-dark text-decoration-none">
        <span class="fs-4">String Ops Page</span>
      </div>
    </header>

    <div class="row mb-4 bg-primary text-dark rounded-3">

      <div class="col-md-6 p-5"> <!- Start String Ops Column ->

        <h6 id="sequence" th:text="'String sequence: ' + ${object}"></h6>

        <div class="row p-4">
          <input type="text" class="form-control" id="new_title" placeholder="input title for new sequence">
          <button class="btn btn-primary bg-secondary" onclick="sequence('new');">New!</button>
        </div>

        <div class="row p-4">
          <input type="text" class="form-control" id="new_sequence" placeholder="input data for the string sequence">
          <button class="btn btn-primary bg-secondary" onclick="sequence('init');">Set!</button>
        </div>

        <div class="row p-4">
          <input type="text" class="form-control" id="append_segment" placeholder="input segment to append to the string sequence">
          <button class="btn btn-primary bg-secondary" onclick="sequence('append');">Append!</button>
        </div>

        <div class="row p-4">
          <input type="text" class="form-control" id="insert_segment" placeholder="input segment to insert to the string sequence">
          <input type="number" class="form-control" id="insert_location" value="0" min="0">
          <button class="btn btn-primary bg-secondary" onclick="sequence('insert');">Insert!</button>
        </div>

        <div class="row p-4">
            <input type="text" class="form-control" id="out_segment" placeholder="input segment to swap out of the string sequence">
            <input type="text" class="form-control" id="in_segment" placeholder="input segment to swap in to the string sequence">
            <button class="btn btn-primary bg-secondary" onclick="sequence('swap');">Swap!</button>
        </div>

      </div> <!- End String Ops column ->

      <div class="col-md-6 p-5"> <!- Start String Sequence column ->

        <table class="table">
          <thead>
            <tr>
              <th scope="col" id="title" th:text="${object.getTitle()}"></th>
            </tr>
          </thead>
          <tbody id="body">
            <tr><td th:text="${object.getStatus()}"></td></tr>
            <tr><td></td></tr> <!- spacer ->
            <tr th:each="event : ${object.getEvents()}">
              <td th:text="${event}"></td>
            </tr>
          </tbody>
        </table>

      </div>  <!- End String Sequence column ->

    </div> <!- End Row ->

  </div> <!- End Container ->
  <script>
    function sequence(action) {
      // body contains all data from user inputs
      const body = {
        action: action,
        title: document.getElementById("new_title").value,
        new_sequence: document.getElementById("new_sequence").value,
        append_segment: document.getElementById("append_segment").value,
        insert_segment: document.getElementById("insert_segment").value,
        insert_location: document.getElementById("insert_location").value,
        out_segment: document.getElementById("out_segment").value,
        in_segment: document.getElementById("in_segment").value
      };
      // call API with body as action/payload
      fetch('/api/strings/', {
        method: "POST",
        credentials: "include",
        body: JSON.stringify(body),
        cache: "no-cache",
        headers: new Headers({
          "content-type": "application/json"
        })
      })
      // async then replies with response header
      .then(function(response) {
        // cleanup prior visual response
        const bodyContainer = document.getElementById("body");
        while (bodyContainer.firstChild) {
          bodyContainer.removeChild(bodyContainer.firstChild);
        }
        // build a visual response from body(JSON) to body(ElementIDs)
        response.json().then(function(body) {
          document.getElementById("sequence").innerHTML = "String sequence: " + body.data;
          document.getElementById("title").innerHTML = body.title;

          // display status message at top of history
          const status = document.createElement("tr");
          status.innerHTML = '<td>' + body.status + '</td>';
          bodyContainer.appendChild(status);

          // insert spacer between status message and event history
          const spacer = document.createElement("tr");
          spacer.innerHTML = '<td></td>';
          bodyContainer.appendChild(spacer);

          // display events (event history)
          for (let i = 0; i < body.events.length; i++) {
            const event = document.createElement("tr");
            event.innerHTML = '<td>' + body.events[i] + '</td>';
            bodyContainer.appendChild(event);
          }

        })
      })
    }
  </script>
</th:block>`

</html>
